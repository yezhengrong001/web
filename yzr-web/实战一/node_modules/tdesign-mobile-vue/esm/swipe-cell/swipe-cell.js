/**
 * tdesign v0.12.1
 * (c) 2022 TDesign Group
 * @license MIT
 */

import _defineProperty from '@babel/runtime/helpers/defineProperty';
import { useSwipe, onClickOutside } from '@vueuse/core';
import { defineComponent, getCurrentInstance, computed, ref, reactive, onMounted, watch, toRefs, resolveComponent, openBlock, createElementBlock, normalizeClass, createElementVNode, normalizeStyle, withModifiers, createVNode, Fragment, renderList, createBlock, withCtx, createTextVNode, toDisplayString } from 'vue';
import props from './props.js';
import config from '../config.js';
import _Button from '../button/index.js';
import '../shared/index.js';
import TNodeComponent from '../shared/render-tnode.js';
import { useEmitEvent } from '../shared/useEmitEvent/index.js';
import { renderContent, renderTNode } from '../shared/render.js';
import '../button/button.js';
import 'tdesign-icons-vue-next';
import '../shared/constants.js';
import '../button/props.js';
import '../shared/functions.js';
import '../shared/util.js';
import '../shared/component.js';
import '../shared/useToggle/index.js';
import '../shared/useCountDown/index.js';
import '@babel/runtime/helpers/asyncToGenerator';
import '@babel/runtime/regenerator';
import '../shared/useCountDown/utils.js';
import '../shared/useDefault/index.js';
import 'lodash/camelCase';
import '../shared/useChildSlots/index.js';
import '@babel/runtime/helpers/toConsumableArray';
import '../shared/useVModel/index.js';
import '../shared/useTouch/index.js';
import '../shared/useScrollParent/index.js';
import '../shared/useExpose/index.js';
import '@babel/runtime/helpers/typeof';
import '../button/style';
import '../button/type.js';

function ownKeys$1(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread$1(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys$1(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$1(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
var prefix = config.prefix;
var name = "".concat(prefix, "-swipe-cell");
var script = defineComponent({
  name: name,
  components: {
    TNode: TNodeComponent,
    TButton: _Button
  },
  props: props,
  emits: ["click", "change"],
  setup: function setup(props2, context) {
    var emitEvent = useEmitEvent(props2, context.emit);
    var internalInstance = getCurrentInstance();
    var swipeContent = computed(function () {
      return renderContent(internalInstance, "default", "content");
    });
    var swipeLeftMenu = computed(function () {
      return renderTNode(internalInstance, "left");
    });
    var swipeRightMenu = computed(function () {
      return renderTNode(internalInstance, "right");
    });
    var leftRef = ref();
    var rightRef = ref();
    var swipeCell = ref();
    var _useSwipe = useSwipe(swipeCell, {
        threshold: 0,
        onSwipeStart: function onSwipeStart(e) {
          initData.moving = true;
          initData.pos = 0;
        },
        onSwipe: function onSwipe(e) {
          if (props2.disabled) {
            return;
          }
          if (initData.moving && initData.status === "close") {
            initData.moving = false;
          }
          var pos = 0;
          if (lengthX.value < 0) {
            if (initData.leftWidth === 0) {
              initData.moving = false;
              return;
            }
            pos = Math.min(Math.abs(lengthX.value), initData.leftWidth > 0 ? initData.leftWidth + spring : 0);
          } else {
            if (initData.rightWidth === 0) {
              initData.moving = false;
              return;
            }
            pos = Math.max(-lengthX.value, -(initData.rightWidth > 0 ? initData.rightWidth + spring : 0));
          }
          if (initData.status === "close") {
            initData.pos = pos;
          }
        },
        onSwipeEnd: function onSwipeEnd(e) {
          end();
        }
      }),
      lengthX = _useSwipe.lengthX;
    var distance = 0;
    var autoBack = true;
    var threshold = 0.5;
    var spring = 0;
    var initData = reactive({
      moving: false,
      leftWidth: 0,
      rightWidth: 0,
      pos: 0,
      status: "close"
    });
    var classes = computed(function () {
      return ["".concat(name)];
    });
    onMounted(function () {
      var _leftRef$value, _rightRef$value;
      var leftWidth = (_leftRef$value = leftRef.value) === null || _leftRef$value === void 0 ? void 0 : _leftRef$value.clientWidth;
      var rightWidth = (_rightRef$value = rightRef.value) === null || _rightRef$value === void 0 ? void 0 : _rightRef$value.clientWidth;
      initData.leftWidth = leftWidth > 0 ? leftWidth + distance : 0;
      initData.rightWidth = rightWidth > 0 ? rightWidth + distance : 0;
      renderMenuStatus();
    });
    watch(function () {
      return props2.expanded;
    }, function () {
      return renderMenuStatus();
    });
    onClickOutside(swipeCell, function (event) {
      close();
    });
    var renderMenuStatus = function renderMenuStatus() {
      if (props2.expanded && props2.expanded === "left") {
        if (initData.leftWidth) {
          open("toRight");
        }
      }
      if (props2.expanded && props2.expanded === "right") {
        if (initData.rightWidth) {
          open("toLeft");
        }
      }
    };
    var end = function end() {
      if (props2.disabled) {
        return;
      }
      if (lengthX.value < 0 && initData.pos > initData.leftWidth * threshold) {
        open("toRight");
      } else if (lengthX.value > 0 && -initData.pos > initData.rightWidth * threshold) {
        open("toLeft");
      } else {
        close("force");
      }
    };
    var open = function open(direction) {
      if (initData.status === "open") {
        return;
      }
      initData.moving = true;
      initData.status = "open";
      if (direction === "toLeft") {
        initData.pos = -initData.rightWidth;
        if (initData.rightWidth) {
          emitEvent("change", "right");
        }
      } else {
        initData.pos = initData.leftWidth;
        if (initData.leftWidth) {
          emitEvent("change", "left");
        }
      }
    };
    var close = function close(type) {
      if (initData.status === "close" && type !== "force") {
        return;
      }
      initData.moving = true;
      initData.status = "close";
      initData.pos = 0;
      emitEvent("change", void 0);
    };
    var handleClickBtn = function handleClickBtn(_ref) {
      var action = _ref.action,
        source = _ref.source;
      if (autoBack) {
        close();
      }
      if (action.onClick) {
        action.onClick();
        return;
      }
      emitEvent("click", {
        action: action,
        source: source
      });
    };
    return _objectSpread$1(_objectSpread$1({}, toRefs(props2)), {}, {
      swipeContent: swipeContent,
      swipeLeftMenu: swipeLeftMenu,
      swipeRightMenu: swipeRightMenu,
      initData: initData,
      classes: classes,
      swipeCell: swipeCell,
      leftRef: leftRef,
      rightRef: rightRef,
      handleClickBtn: handleClickBtn,
      end: end
    });
  }
});

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function render(_ctx, _cache, $props, $setup, $data, $options) {
  var _normalizeClass2;
  var _component_t_node = resolveComponent("t-node");
  var _component_t_button = resolveComponent("t-button");
  return openBlock(), createElementBlock("div", {
    class: normalizeClass(_ctx.classes),
    onTouchend: _cache[2] || (_cache[2] = function () {
      return _ctx.end && _ctx.end.apply(_ctx, arguments);
    }),
    onTouchcancel: _cache[3] || (_cache[3] = function () {
      return _ctx.end && _ctx.end.apply(_ctx, arguments);
    }),
    onMouseup: _cache[4] || (_cache[4] = function () {
      return _ctx.end && _ctx.end.apply(_ctx, arguments);
    })
  }, [createElementVNode("div", {
    class: normalizeClass((_normalizeClass2 = {}, _defineProperty(_normalizeClass2, _ctx.classes + "__wrapper", true), _defineProperty(_normalizeClass2, "moving", _ctx.initData.moving), _normalizeClass2)),
    style: normalizeStyle({
      transform: "translate3d(".concat(_ctx.initData.pos, "px,0,0)")
    })
  }, [createElementVNode("div", {
    ref: "leftRef",
    class: normalizeClass(_ctx.classes + "__left"),
    style: normalizeStyle({
      width: _ctx.initData.leftWidth ? "".concat(_ctx.initData.leftWidth, "px") : "auto"
    }),
    onTouchstartPassive: _cache[0] || (_cache[0] = withModifiers(function () {}, ["stop"]))
  }, [createVNode(_component_t_node, {
    content: _ctx.swipeLeftMenu
  }, null, 8, ["content"]), (openBlock(true), createElementBlock(Fragment, null, renderList(_ctx.left, function (btn, index) {
    return openBlock(), createBlock(_component_t_button, {
      key: index,
      class: normalizeClass(btn.className || ""),
      style: normalizeStyle(btn.style || "height: 100%"),
      onClick: function onClick($event) {
        return _ctx.handleClickBtn({
          action: _objectSpread({}, btn),
          source: "left"
        });
      }
    }, {
      default: withCtx(function () {
        return [createTextVNode(toDisplayString(btn.text), 1)];
      }),
      _: 2
    }, 1032, ["class", "style", "onClick"]);
  }), 128))], 38), createElementVNode("div", {
    ref: "swipeCell",
    class: normalizeClass(_ctx.classes + "__content")
  }, [createVNode(_component_t_node, {
    content: _ctx.swipeContent
  }, null, 8, ["content"])], 2), createElementVNode("div", {
    ref: "rightRef",
    class: normalizeClass(_ctx.classes + "__right"),
    style: normalizeStyle({
      width: _ctx.initData.rightWidth ? "".concat(_ctx.initData.rightWidth, "px") : "auto"
    }),
    onTouchstartPassive: _cache[1] || (_cache[1] = withModifiers(function () {}, ["stop"]))
  }, [createVNode(_component_t_node, {
    content: _ctx.swipeRightMenu
  }, null, 8, ["content"]), (openBlock(true), createElementBlock(Fragment, null, renderList(_ctx.right, function (btn, index) {
    return openBlock(), createBlock(_component_t_button, {
      key: index,
      class: normalizeClass(btn.className || ""),
      style: normalizeStyle(btn.style || "height: 100%"),
      onClick: function onClick($event) {
        return _ctx.handleClickBtn({
          action: _objectSpread({}, btn),
          source: "right"
        });
      }
    }, {
      default: withCtx(function () {
        return [createTextVNode(toDisplayString(btn.text), 1)];
      }),
      _: 2
    }, 1032, ["class", "style", "onClick"]);
  }), 128))], 38)], 6)], 34);
}

script.render = render;

export { script as default };
//# sourceMappingURL=swipe-cell.js.map
