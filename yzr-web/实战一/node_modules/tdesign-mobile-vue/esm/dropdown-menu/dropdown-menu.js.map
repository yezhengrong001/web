{"version":3,"file":"dropdown-menu.js","sources":["../../src/dropdown-menu/dropdown-menu.vue","../../src/dropdown-menu/dropdown-menu.vue?vue&type=template&id=f261c384&lang.js"],"sourcesContent":["<template>\n  <div :class=\"classes\">\n    <div ref=\"refBar\" :class=\"styleBar\">\n      <div v-for=\"(item, idx) in menuTitles\" :key=\"idx\" :class=\"styleBarItem(item, idx)\" @click=\"expandMenu(item, idx)\">\n        <div :class=\"`${name}__title`\">\n          {{ item.label }}\n        </div>\n        <caret-down-small-icon :class=\"`${name}__arrow`\" size=\"24\" />\n      </div>\n    </div>\n    <slot />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, computed, toRefs, ref, reactive, watch, provide } from 'vue';\nimport { CaretDownSmallIcon } from 'tdesign-icons-vue-next';\nimport config from '../config';\nimport { context as menuContext, DropdownMenuState, DropdownMenuControl, DropdownMenuExpandState } from './context';\nimport TransAniControl from './trans-ani-control';\nimport { findRelativeRect, findRelativeContainer } from './dom-utils';\nimport DropdownMenuProps from './props';\n\nconst { prefix } = config;\nconst name = `${prefix}-dropdown-menu`;\n\nexport default defineComponent({\n  name,\n  components: { CaretDownSmallIcon },\n  props: DropdownMenuProps,\n  setup(props, { slots, expose }) {\n    // 菜单状态\n    const state = reactive<DropdownMenuState>({\n      activeId: null,\n      barRect: {},\n      childCount: 0,\n    });\n\n    // 子成员处理\n    const menuItems = ref<any>([]);\n    const updateItems = () => {\n      if (slots.default) {\n        const itemName = `${prefix}-dropdown-item`;\n        const children = slots.default();\n        menuItems.value = children.filter((child: any) => {\n          const childTypeName = child?.type?.name;\n          return childTypeName?.includes && childTypeName.includes(itemName);\n        });\n      }\n    };\n    watch(() => slots?.default?.(), updateItems, {\n      deep: true,\n      immediate: true,\n    });\n\n    // 通过 slots.default 子成员，计算标题栏选项\n    const menuTitles = computed(() =>\n      menuItems.value.map((item: any) => {\n        const { label, disabled } = item.props;\n        return {\n          label,\n          disabled: disabled !== undefined && disabled !== false,\n        };\n      }),\n    );\n\n    const aniControl = new TransAniControl();\n    // 提供子组件访问\n    provide('dropdownMenuProps', props);\n    provide('dropdownMenuState', state);\n    provide('dropdownAniControl', aniControl);\n    // 根结点样式\n    const classes = computed(() => [`${name}`]);\n    // 标题栏结点引用\n    const refBar = ref(null);\n    // 标题栏样式\n    const styleBar = computed(() => [\n      `${name}__bar`,\n      {\n        [`${name}__bar ${name}__bar--open`]: state.activeId,\n      },\n    ]);\n    const styleBarItem = computed(() => (item: any, idx: number) => [\n      `${name}__item`,\n      {\n        [`${prefix}-is-disabled`]: item.disabled,\n        [`${prefix}-is-active`]: idx === state.activeId,\n      },\n    ]);\n    // 展开对应项目的菜单\n    const expandMenu = (item: any, idx: number) => {\n      const { disabled } = item;\n\n      if (disabled) return;\n\n      if (state.activeId === idx) {\n        // 再次点击时收起\n        collapseMenu();\n        return;\n      }\n\n      state.activeId = idx;\n\n      // 获取菜单定位\n      const bar = refBar.value as any;\n      const barRect = findRelativeRect(bar);\n      state.barRect = barRect;\n\n      // 记录展开状态\n      const container = findRelativeContainer(bar) || document.body;\n      menuContext.recordMenuExpanded(container, control, DropdownMenuExpandState.expanded);\n    };\n    const collapseMenu = () => {\n      state.activeId = null;\n\n      // 清除已展开状态记录\n      const bar = refBar.value as any;\n      const container = findRelativeContainer(bar) || document.body;\n      menuContext.recordMenuExpanded(container, control, DropdownMenuExpandState.collapsed);\n    };\n    const control: DropdownMenuControl = { expandMenu, collapseMenu };\n    // 提供子组件访问\n    provide('dropdownMenuControl', control);\n    expose({\n      toggle(idx?: number) {\n        if (idx != null) {\n          const item = menuTitles.value[idx];\n          expandMenu(item, idx);\n        } else {\n          collapseMenu();\n        }\n      },\n    });\n    return {\n      name: ref(name),\n      classes,\n      ...toRefs(props),\n      refBar,\n      state,\n      styleBar,\n      styleBarItem,\n      menuItems,\n      menuTitles,\n      expandMenu,\n    };\n  },\n});\n</script>\n","<template>\n  <div :class=\"classes\">\n    <div ref=\"refBar\" :class=\"styleBar\">\n      <div v-for=\"(item, idx) in menuTitles\" :key=\"idx\" :class=\"styleBarItem(item, idx)\" @click=\"expandMenu(item, idx)\">\n        <div :class=\"`${name}__title`\">\n          {{ item.label }}\n        </div>\n        <caret-down-small-icon :class=\"`${name}__arrow`\" size=\"24\" />\n      </div>\n    </div>\n    <slot />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, computed, toRefs, ref, reactive, watch, provide } from 'vue';\nimport { CaretDownSmallIcon } from 'tdesign-icons-vue-next';\nimport config from '../config';\nimport { context as menuContext, DropdownMenuState, DropdownMenuControl, DropdownMenuExpandState } from './context';\nimport TransAniControl from './trans-ani-control';\nimport { findRelativeRect, findRelativeContainer } from './dom-utils';\nimport DropdownMenuProps from './props';\n\nconst { prefix } = config;\nconst name = `${prefix}-dropdown-menu`;\n\nexport default defineComponent({\n  name,\n  components: { CaretDownSmallIcon },\n  props: DropdownMenuProps,\n  setup(props, { slots, expose }) {\n    // 菜单状态\n    const state = reactive<DropdownMenuState>({\n      activeId: null,\n      barRect: {},\n      childCount: 0,\n    });\n\n    // 子成员处理\n    const menuItems = ref<any>([]);\n    const updateItems = () => {\n      if (slots.default) {\n        const itemName = `${prefix}-dropdown-item`;\n        const children = slots.default();\n        menuItems.value = children.filter((child: any) => {\n          const childTypeName = child?.type?.name;\n          return childTypeName?.includes && childTypeName.includes(itemName);\n        });\n      }\n    };\n    watch(() => slots?.default?.(), updateItems, {\n      deep: true,\n      immediate: true,\n    });\n\n    // 通过 slots.default 子成员，计算标题栏选项\n    const menuTitles = computed(() =>\n      menuItems.value.map((item: any) => {\n        const { label, disabled } = item.props;\n        return {\n          label,\n          disabled: disabled !== undefined && disabled !== false,\n        };\n      }),\n    );\n\n    const aniControl = new TransAniControl();\n    // 提供子组件访问\n    provide('dropdownMenuProps', props);\n    provide('dropdownMenuState', state);\n    provide('dropdownAniControl', aniControl);\n    // 根结点样式\n    const classes = computed(() => [`${name}`]);\n    // 标题栏结点引用\n    const refBar = ref(null);\n    // 标题栏样式\n    const styleBar = computed(() => [\n      `${name}__bar`,\n      {\n        [`${name}__bar ${name}__bar--open`]: state.activeId,\n      },\n    ]);\n    const styleBarItem = computed(() => (item: any, idx: number) => [\n      `${name}__item`,\n      {\n        [`${prefix}-is-disabled`]: item.disabled,\n        [`${prefix}-is-active`]: idx === state.activeId,\n      },\n    ]);\n    // 展开对应项目的菜单\n    const expandMenu = (item: any, idx: number) => {\n      const { disabled } = item;\n\n      if (disabled) return;\n\n      if (state.activeId === idx) {\n        // 再次点击时收起\n        collapseMenu();\n        return;\n      }\n\n      state.activeId = idx;\n\n      // 获取菜单定位\n      const bar = refBar.value as any;\n      const barRect = findRelativeRect(bar);\n      state.barRect = barRect;\n\n      // 记录展开状态\n      const container = findRelativeContainer(bar) || document.body;\n      menuContext.recordMenuExpanded(container, control, DropdownMenuExpandState.expanded);\n    };\n    const collapseMenu = () => {\n      state.activeId = null;\n\n      // 清除已展开状态记录\n      const bar = refBar.value as any;\n      const container = findRelativeContainer(bar) || document.body;\n      menuContext.recordMenuExpanded(container, control, DropdownMenuExpandState.collapsed);\n    };\n    const control: DropdownMenuControl = { expandMenu, collapseMenu };\n    // 提供子组件访问\n    provide('dropdownMenuControl', control);\n    expose({\n      toggle(idx?: number) {\n        if (idx != null) {\n          const item = menuTitles.value[idx];\n          expandMenu(item, idx);\n        } else {\n          collapseMenu();\n        }\n      },\n    });\n    return {\n      name: ref(name),\n      classes,\n      ...toRefs(props),\n      refBar,\n      state,\n      styleBar,\n      styleBarItem,\n      menuItems,\n      menuTitles,\n      expandMenu,\n    };\n  },\n});\n</script>\n"],"names":["prefix","config","name","defineComponent","components","CaretDownSmallIcon","props","DropdownMenuProps","setup","slots","expose","state","reactive","activeId","barRect","childCount","menuItems","ref","updateItems","default","itemName","children","value","filter","child","childTypeName","type","includes","watch","deep","immediate","menuTitles","computed","map","item","label","disabled","aniControl","TransAniControl","provide","classes","refBar","styleBar","styleBarItem","idx","expandMenu","collapseMenu","bar","findRelativeRect","container","findRelativeContainer","document","body","menuContext","recordMenuExpanded","control","DropdownMenuExpandState","expanded","collapsed","toggle","toRefs","_createElementBlock","class","_ctx","_createElementVNode","_openBlock","_Fragment","_renderList","key","_normalizeClass","onClick","$event","_toDisplayString","_createVNode","_component_caret_down_small_icon","size","_renderSlot","$slots"],"mappings":"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"}