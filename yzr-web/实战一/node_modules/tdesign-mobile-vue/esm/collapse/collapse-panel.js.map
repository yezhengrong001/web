{"version":3,"file":"collapse-panel.js","sources":["../../src/collapse/collapse-panel.vue","../../src/collapse/collapse-panel.vue?vue&type=template&id=50e4b8fe&lang.js"],"sourcesContent":["<template>\n  <div ref=\"$wrap\" :class=\"className\">\n    <div ref=\"$head\" :class=\"`${classPrefix}__header`\" @click=\"handleClick\">\n      <div :class=\"`${classPrefix}__title`\">\n        <slot name=\"header\">{{ header }}</slot>\n      </div>\n      <div :class=\"`${classPrefix}__header-right`\">\n        <div v-if=\"headerRightContent || $slots.headerRightContent\" :class=\"`${classPrefix}__header-extra`\">\n          <slot name=\"headerRightContent\">{{ headerRightContent }}</slot>\n        </div>\n        <component :is=\"rightIcon\" :class=\"`${classPrefix}__header-icon`\" />\n      </div>\n    </div>\n    <div ref=\"$body\" :class=\"`${classPrefix}__body`\">\n      <t-node :content=\"panelContent\"></t-node>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport {\n  ref,\n  computed,\n  nextTick,\n  watch,\n  onMounted,\n  inject,\n  SetupContext,\n  defineComponent,\n  getCurrentInstance,\n} from 'vue';\nimport { ChevronDownIcon, ChevronUpIcon } from 'tdesign-icons-vue-next';\nimport props from './collapse-panel-props';\nimport config from '../config';\nimport { findIndex } from './util';\nimport { renderTNode, renderContent, TNode } from '../shared';\nimport { CollapseProvide } from './collapse.vue';\n\nconst { prefix } = config;\nconst name = `${prefix}-collapse-panel`;\nexport default defineComponent({\n  name,\n  components: { ChevronDownIcon, ChevronUpIcon, TNode },\n  props,\n  setup(props, context: SetupContext) {\n    const internalInstance = getCurrentInstance();\n    const parent = inject<CollapseProvide>('collapse');\n    const isTrue = (val: any) => typeof val === 'boolean' && val;\n\n    const rightIcon = computed(() => {\n      if (props.expandIcon === false) return;\n      if (isTrue(props.expandIcon) || isTrue(parent?.expandIcon.value)) {\n        console.log(isTrue(parent?.expandIcon.value));\n\n        return isActive.value ? ChevronDownIcon : ChevronUpIcon;\n      }\n      return renderTNode(internalInstance, 'expand-icon')[0];\n    });\n    const disabled = computed(() => parent?.disabled.value || props.disabled);\n    const className = computed(() => ({\n      [`${name}`]: true,\n      [`${name}--active`]: isActive.value,\n      [`${name}--disabled`]: disabled.value,\n    }));\n    const isActive = computed(() => findIndex(props.value, parent?.activeValue.value) > -1);\n    const updatePanelValue = () => {\n      if (props.value != null) {\n        parent?.onPanelChange(props.value);\n      }\n    };\n    const handleClick = (e: MouseEvent) => {\n      e?.stopPropagation();\n      if (disabled.value) {\n        return;\n      }\n      updatePanelValue();\n    };\n    const panelContent = renderContent(internalInstance, 'default', 'content');\n\n    // 设置折叠/展开高度过渡\n    const $body = ref();\n    const $wrap = ref();\n    const $head = ref();\n    const updatePanelState = () => {\n      if (!$wrap.value) {\n        // console.log('[collapse] 组件尚未挂载', $wrap.value);\n        return;\n      }\n      const { height: headHeight } = $head.value.getBoundingClientRect();\n      if (!isActive.value) {\n        $wrap.value.style.height = `${headHeight}px`;\n        return;\n      }\n      const { height: bodyHeight } = $body.value.getBoundingClientRect();\n      const height = headHeight + bodyHeight;\n      $wrap.value.style.height = `${height}px`;\n    };\n\n    watch(isActive, () => {\n      nextTick(() => {\n        updatePanelState();\n      });\n    });\n\n    onMounted(() => {\n      if (parent?.defaultExpandAll) {\n        updatePanelValue();\n      }\n      updatePanelState();\n    });\n\n    return {\n      classPrefix: name,\n      rightIcon,\n      $head,\n      $body,\n      $wrap,\n      className,\n      handleClick,\n      panelContent,\n    };\n  },\n});\n</script>\n","<template>\n  <div ref=\"$wrap\" :class=\"className\">\n    <div ref=\"$head\" :class=\"`${classPrefix}__header`\" @click=\"handleClick\">\n      <div :class=\"`${classPrefix}__title`\">\n        <slot name=\"header\">{{ header }}</slot>\n      </div>\n      <div :class=\"`${classPrefix}__header-right`\">\n        <div v-if=\"headerRightContent || $slots.headerRightContent\" :class=\"`${classPrefix}__header-extra`\">\n          <slot name=\"headerRightContent\">{{ headerRightContent }}</slot>\n        </div>\n        <component :is=\"rightIcon\" :class=\"`${classPrefix}__header-icon`\" />\n      </div>\n    </div>\n    <div ref=\"$body\" :class=\"`${classPrefix}__body`\">\n      <t-node :content=\"panelContent\"></t-node>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport {\n  ref,\n  computed,\n  nextTick,\n  watch,\n  onMounted,\n  inject,\n  SetupContext,\n  defineComponent,\n  getCurrentInstance,\n} from 'vue';\nimport { ChevronDownIcon, ChevronUpIcon } from 'tdesign-icons-vue-next';\nimport props from './collapse-panel-props';\nimport config from '../config';\nimport { findIndex } from './util';\nimport { renderTNode, renderContent, TNode } from '../shared';\nimport { CollapseProvide } from './collapse.vue';\n\nconst { prefix } = config;\nconst name = `${prefix}-collapse-panel`;\nexport default defineComponent({\n  name,\n  components: { ChevronDownIcon, ChevronUpIcon, TNode },\n  props,\n  setup(props, context: SetupContext) {\n    const internalInstance = getCurrentInstance();\n    const parent = inject<CollapseProvide>('collapse');\n    const isTrue = (val: any) => typeof val === 'boolean' && val;\n\n    const rightIcon = computed(() => {\n      if (props.expandIcon === false) return;\n      if (isTrue(props.expandIcon) || isTrue(parent?.expandIcon.value)) {\n        console.log(isTrue(parent?.expandIcon.value));\n\n        return isActive.value ? ChevronDownIcon : ChevronUpIcon;\n      }\n      return renderTNode(internalInstance, 'expand-icon')[0];\n    });\n    const disabled = computed(() => parent?.disabled.value || props.disabled);\n    const className = computed(() => ({\n      [`${name}`]: true,\n      [`${name}--active`]: isActive.value,\n      [`${name}--disabled`]: disabled.value,\n    }));\n    const isActive = computed(() => findIndex(props.value, parent?.activeValue.value) > -1);\n    const updatePanelValue = () => {\n      if (props.value != null) {\n        parent?.onPanelChange(props.value);\n      }\n    };\n    const handleClick = (e: MouseEvent) => {\n      e?.stopPropagation();\n      if (disabled.value) {\n        return;\n      }\n      updatePanelValue();\n    };\n    const panelContent = renderContent(internalInstance, 'default', 'content');\n\n    // 设置折叠/展开高度过渡\n    const $body = ref();\n    const $wrap = ref();\n    const $head = ref();\n    const updatePanelState = () => {\n      if (!$wrap.value) {\n        // console.log('[collapse] 组件尚未挂载', $wrap.value);\n        return;\n      }\n      const { height: headHeight } = $head.value.getBoundingClientRect();\n      if (!isActive.value) {\n        $wrap.value.style.height = `${headHeight}px`;\n        return;\n      }\n      const { height: bodyHeight } = $body.value.getBoundingClientRect();\n      const height = headHeight + bodyHeight;\n      $wrap.value.style.height = `${height}px`;\n    };\n\n    watch(isActive, () => {\n      nextTick(() => {\n        updatePanelState();\n      });\n    });\n\n    onMounted(() => {\n      if (parent?.defaultExpandAll) {\n        updatePanelValue();\n      }\n      updatePanelState();\n    });\n\n    return {\n      classPrefix: name,\n      rightIcon,\n      $head,\n      $body,\n      $wrap,\n      className,\n      handleClick,\n      panelContent,\n    };\n  },\n});\n</script>\n"],"names":["prefix","config","name","defineComponent","components","ChevronDownIcon","ChevronUpIcon","TNode","props","setup","context","internalInstance","getCurrentInstance","parent","inject","isTrue","val","rightIcon","computed","expandIcon","value","console","log","isActive","renderTNode","disabled","className","findIndex","activeValue","updatePanelValue","onPanelChange","handleClick","e","stopPropagation","panelContent","renderContent","$body","ref","$wrap","$head","updatePanelState","getBoundingClientRect","headHeight","height","style","bodyHeight","watch","nextTick","onMounted","defaultExpandAll","classPrefix","_createElementBlock","class","_ctx","_createElementVNode","onClick","_renderSlot","header","headerRightContent","$slots","_openBlock","_createBlock","_resolveDynamicComponent","_createVNode","_component_t_node","content"],"mappings":"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"}