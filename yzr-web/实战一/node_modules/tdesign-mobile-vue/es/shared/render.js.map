{"version":3,"file":"render.js","sources":["../../src/shared/render.ts"],"sourcesContent":["import { h, ComponentInternalInstance, Slots, VNode } from 'vue';\nimport camelCase from 'lodash/camelCase';\n\ninterface JSXRenderContext {\n  defaultNode?: VNode;\n  params?: Record<string, any>;\n}\n\n/**\n * 渲染 TNode，props 和 插槽同时处理。与 renderTNodeJSX 区别在于 属性值为 undefined 时会渲染默认节点\n * @param instance 组件示例\n * @param name 插槽和属性名称\n * @param options 缺省插槽内容\n * @example renderTNode(getCurrentInstance(), 'closeBtn')\n * @example renderTNode(getCurrentInstance(), 'closeBtn', <t-icon-close />)。this.closeBtn 为空时，则兜底渲染 <t-icon-close />\n */\nexport const renderTNode = (\n  instance: ComponentInternalInstance | null,\n  name: string,\n  options?: Slots | JSXRenderContext,\n): any => {\n  if (instance === null) {\n    return h('', null);\n  }\n\n  const params = typeof options === 'object' && 'params' in options ? options.params : null;\n  const defaultNode = typeof options === 'object' && 'defaultNode' in options ? options.defaultNode : options;\n  let propsNode: any;\n  if (name in instance.props || camelCase(name) in instance.props) {\n    propsNode = instance.props[name] || instance.props[camelCase(name)];\n  }\n  // if (propsNode === false) return;\n\n  // 同名优先处理插槽\n  if (instance.slots[name]) {\n    return instance.slots[name]?.call(params);\n  }\n\n  if (propsNode === true && defaultNode) {\n    return instance.slots[name] ? instance.slots[name]?.call(params) : defaultNode;\n  }\n\n  if (typeof propsNode === 'function') return propsNode(h, params);\n\n  const isPropsEmpty = [undefined, params, ''].includes(propsNode);\n  if (isPropsEmpty && instance.slots[name]) return instance.slots[name]?.call(params);\n  return propsNode;\n};\n\n/**\n * 用于处理相同名称的 TNode 渲染\n * @param vm 组件实例\n * @param name1 第一个名称，优先级高于 name2\n * @param name2 第二个名称\n * @param defaultNode 默认渲染内容：当 name1 和 name2 都为空时会启动默认内容渲染\n * @example renderContent(this, 'default', 'content')\n * @example renderContent(this, 'default', 'content', '我是默认内容')\n * @example renderContent(this, 'default', 'content', { defaultNode: '我是默认内容', params })\n */\nexport const renderContent = (\n  instance: ComponentInternalInstance | null,\n  name1: string,\n  name2: string,\n  options?: VNode | JSXRenderContext,\n): any => {\n  if (instance === null) {\n    return h('', null);\n  }\n  const params = typeof options === 'object' && 'params' in options ? options.params : null;\n  const defaultNode = typeof options === 'object' && 'defaultNode' in options ? options.defaultNode : options;\n  const toParams = params ? { params } : undefined;\n  const node1 = renderTNode(instance, name1, toParams);\n  const node2 = renderTNode(instance, name2, toParams);\n  const r = [undefined, null, ''].includes(node1) ? node2 : node1;\n  return [undefined, null, ''].includes(r) ? defaultNode : r;\n};\n"],"names":["renderTNode","instance","name","options","h","params","defaultNode","propsNode","props","camelCase","slots","call","isPropsEmpty","includes","renderContent","name1","name2","toParams","node1","node2","r"],"mappings":"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"}