{"version":3,"file":"textarea.js","sources":["../../src/textarea/textarea.vue","../../src/textarea/textarea.vue?vue&type=template&id=67798370&lang.js"],"sourcesContent":["<template>\n  <div :class=\"componentName\">\n    <div v-if=\"labelContent\" :class=\"`${componentName}__name`\">\n      <t-node :content=\"labelContent\"></t-node>\n    </div>\n    <div :class=\"textareaClassNames\">\n      <textarea\n        ref=\"textareaRef\"\n        :value=\"innerValue\"\n        :style=\"textareaStyle\"\n        :name=\"name\"\n        :maxlength=\"maxlength || -1\"\n        :disabled=\"disabled\"\n        :placeholder=\"placeholder\"\n        @focus=\"handleFocus\"\n        @blur=\"handleBlur\"\n        @input=\"handleInput\"\n        @compositionend=\"handleCompositionend\"\n      />\n      <div v-if=\"maxcharacter || maxlength\" :class=\"`${componentName}__count`\">\n        {{ `${textareaLength}/${maxcharacter || maxlength}` }}\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, ref, onMounted, defineComponent, getCurrentInstance, toRefs, SetupContext, nextTick } from 'vue';\nimport { useEmitEvent, renderTNode, TNode, getCharacterLength, useVModel } from '../shared';\nimport config from '../config';\nimport TextareaProps from './props';\nimport { TdTextareaProps, TextareaValue } from './type';\nimport calcTextareaHeight from '../_common/js/utils/calcTextareaHeight';\n\nconst { prefix } = config;\nconst componentName = `${prefix}-textarea`;\n\nexport default defineComponent({\n  name: componentName,\n  components: {\n    TNode,\n  },\n  props: TextareaProps,\n  emits: ['update:value', 'update:modelValue', 'focus', 'blur', 'change'],\n  setup(props, context: SetupContext) {\n    const emitEvent = useEmitEvent(props, context.emit);\n    const textareaRef = ref<null | HTMLElement>(null);\n    const textareaStyle = ref();\n    const textareaLength = ref(0);\n    const { value, modelValue } = toRefs(props);\n    const [innerValue, setInnerValue] = useVModel(value, modelValue, props.defaultValue, props.onChange);\n\n    const textareaClassNames = computed(() => [\n      `${componentName}__wrapper`,\n      {\n        [`${componentName}-is-disabled`]: props.disabled,\n      },\n    ]);\n    const internalInstance = getCurrentInstance();\n    const labelContent = computed(() => renderTNode(internalInstance, 'label'));\n\n    const setInputValue = (v: TextareaValue = '') => {\n      const input = textareaRef.value as HTMLTextAreaElement;\n      const sV = String(v);\n      if (!input) {\n        return;\n      }\n      if (input.value !== sV) {\n        input.value = sV;\n      }\n    };\n\n    const adjustTextareaHeight = () => {\n      if (props.autosize === true) {\n        textareaStyle.value = calcTextareaHeight(textareaRef.value as HTMLTextAreaElement);\n      } else if (typeof props.autosize === 'object') {\n        const { minRows, maxRows } = props.autosize;\n        textareaStyle.value = calcTextareaHeight(textareaRef.value as HTMLTextAreaElement, minRows, maxRows);\n      } else if (context.attrs.rows) {\n        textareaStyle.value = { height: 'auto', minHeight: 'auto' };\n      }\n    };\n\n    const handleInput = (e: any) => {\n      if (e.isComposing || e.inputType === 'insertCompositionText') return;\n      textareaValueChangeHandle(e);\n    };\n\n    const textareaValueChangeHandle = (e: InputEvent) => {\n      const { target } = e;\n      const { value } = target as HTMLInputElement;\n      if (props.maxcharacter && props.maxcharacter > 0 && !Number.isNaN(props.maxcharacter)) {\n        const { length = 0, characters = '' } = getCharacterLength(value, props.maxcharacter) as {\n          length: number;\n          characters: string;\n        };\n        setInnerValue(characters);\n        textareaLength.value = length;\n      } else {\n        setInnerValue(value);\n        textareaLength.value = String(innerValue.value).length;\n      }\n      nextTick(() => setInputValue(innerValue.value));\n      adjustTextareaHeight();\n    };\n\n    const handleCompositionend = (e: InputEvent | CompositionEvent) => {\n      textareaValueChangeHandle(e as InputEvent);\n    };\n\n    const handleFocus = (e: FocusEvent) => {\n      emitEvent('focus', innerValue.value, { e });\n    };\n    const handleBlur = (e: FocusEvent) => {\n      emitEvent('blur', innerValue.value, { e });\n    };\n\n    onMounted(() => {\n      if (props.autofocus) {\n        textareaRef.value?.focus();\n      }\n      adjustTextareaHeight();\n    });\n\n    return {\n      componentName,\n      ...toRefs(props),\n      labelContent,\n      innerValue,\n      textareaRef,\n      textareaStyle,\n      textareaClassNames,\n      textareaLength,\n      handleFocus,\n      handleBlur,\n      handleInput,\n      handleCompositionend,\n    };\n  },\n});\n</script>\n","<template>\n  <div :class=\"componentName\">\n    <div v-if=\"labelContent\" :class=\"`${componentName}__name`\">\n      <t-node :content=\"labelContent\"></t-node>\n    </div>\n    <div :class=\"textareaClassNames\">\n      <textarea\n        ref=\"textareaRef\"\n        :value=\"innerValue\"\n        :style=\"textareaStyle\"\n        :name=\"name\"\n        :maxlength=\"maxlength || -1\"\n        :disabled=\"disabled\"\n        :placeholder=\"placeholder\"\n        @focus=\"handleFocus\"\n        @blur=\"handleBlur\"\n        @input=\"handleInput\"\n        @compositionend=\"handleCompositionend\"\n      />\n      <div v-if=\"maxcharacter || maxlength\" :class=\"`${componentName}__count`\">\n        {{ `${textareaLength}/${maxcharacter || maxlength}` }}\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, ref, onMounted, defineComponent, getCurrentInstance, toRefs, SetupContext, nextTick } from 'vue';\nimport { useEmitEvent, renderTNode, TNode, getCharacterLength, useVModel } from '../shared';\nimport config from '../config';\nimport TextareaProps from './props';\nimport { TdTextareaProps, TextareaValue } from './type';\nimport calcTextareaHeight from '../_common/js/utils/calcTextareaHeight';\n\nconst { prefix } = config;\nconst componentName = `${prefix}-textarea`;\n\nexport default defineComponent({\n  name: componentName,\n  components: {\n    TNode,\n  },\n  props: TextareaProps,\n  emits: ['update:value', 'update:modelValue', 'focus', 'blur', 'change'],\n  setup(props, context: SetupContext) {\n    const emitEvent = useEmitEvent(props, context.emit);\n    const textareaRef = ref<null | HTMLElement>(null);\n    const textareaStyle = ref();\n    const textareaLength = ref(0);\n    const { value, modelValue } = toRefs(props);\n    const [innerValue, setInnerValue] = useVModel(value, modelValue, props.defaultValue, props.onChange);\n\n    const textareaClassNames = computed(() => [\n      `${componentName}__wrapper`,\n      {\n        [`${componentName}-is-disabled`]: props.disabled,\n      },\n    ]);\n    const internalInstance = getCurrentInstance();\n    const labelContent = computed(() => renderTNode(internalInstance, 'label'));\n\n    const setInputValue = (v: TextareaValue = '') => {\n      const input = textareaRef.value as HTMLTextAreaElement;\n      const sV = String(v);\n      if (!input) {\n        return;\n      }\n      if (input.value !== sV) {\n        input.value = sV;\n      }\n    };\n\n    const adjustTextareaHeight = () => {\n      if (props.autosize === true) {\n        textareaStyle.value = calcTextareaHeight(textareaRef.value as HTMLTextAreaElement);\n      } else if (typeof props.autosize === 'object') {\n        const { minRows, maxRows } = props.autosize;\n        textareaStyle.value = calcTextareaHeight(textareaRef.value as HTMLTextAreaElement, minRows, maxRows);\n      } else if (context.attrs.rows) {\n        textareaStyle.value = { height: 'auto', minHeight: 'auto' };\n      }\n    };\n\n    const handleInput = (e: any) => {\n      if (e.isComposing || e.inputType === 'insertCompositionText') return;\n      textareaValueChangeHandle(e);\n    };\n\n    const textareaValueChangeHandle = (e: InputEvent) => {\n      const { target } = e;\n      const { value } = target as HTMLInputElement;\n      if (props.maxcharacter && props.maxcharacter > 0 && !Number.isNaN(props.maxcharacter)) {\n        const { length = 0, characters = '' } = getCharacterLength(value, props.maxcharacter) as {\n          length: number;\n          characters: string;\n        };\n        setInnerValue(characters);\n        textareaLength.value = length;\n      } else {\n        setInnerValue(value);\n        textareaLength.value = String(innerValue.value).length;\n      }\n      nextTick(() => setInputValue(innerValue.value));\n      adjustTextareaHeight();\n    };\n\n    const handleCompositionend = (e: InputEvent | CompositionEvent) => {\n      textareaValueChangeHandle(e as InputEvent);\n    };\n\n    const handleFocus = (e: FocusEvent) => {\n      emitEvent('focus', innerValue.value, { e });\n    };\n    const handleBlur = (e: FocusEvent) => {\n      emitEvent('blur', innerValue.value, { e });\n    };\n\n    onMounted(() => {\n      if (props.autofocus) {\n        textareaRef.value?.focus();\n      }\n      adjustTextareaHeight();\n    });\n\n    return {\n      componentName,\n      ...toRefs(props),\n      labelContent,\n      innerValue,\n      textareaRef,\n      textareaStyle,\n      textareaClassNames,\n      textareaLength,\n      handleFocus,\n      handleBlur,\n      handleInput,\n      handleCompositionend,\n    };\n  },\n});\n</script>\n"],"names":["prefix","config","componentName","defineComponent","name","components","TNode","props","TextareaProps","emits","setup","context","emitEvent","useEmitEvent","emit","textareaRef","ref","textareaStyle","textareaLength","toRefs","value","modelValue","useVModel","defaultValue","onChange","_slicedToArray","innerValue","setInnerValue","textareaClassNames","computed","disabled","internalInstance","getCurrentInstance","labelContent","renderTNode","setInputValue","v","input","sV","String","adjustTextareaHeight","autosize","calcTextareaHeight","_typeof","minRows","maxRows","attrs","rows","height","minHeight","handleInput","e","isComposing","inputType","textareaValueChangeHandle","target","maxcharacter","Number","isNaN","getCharacterLength","length","characters","nextTick","handleCompositionend","handleFocus","handleBlur","onMounted","autofocus","focus","_createElementBlock","class","_ctx","_createVNode","_component_t_node","content","_createElementVNode","style","maxlength","placeholder","onFocus","onBlur","onInput","onCompositionend"],"mappings":"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"}