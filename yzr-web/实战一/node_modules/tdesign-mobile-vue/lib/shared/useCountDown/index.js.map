{"version":3,"file":"index.js","sources":["../../../src/shared/useCountDown/index.ts"],"sourcesContent":["import { watch, ref, reactive } from 'vue';\nimport { useRafFn } from '@vueuse/core';\nimport { TdUseCountDownProps, TdUseCountDown } from './type';\nimport { getRemainTimes, getShowTimes, getScreenFps } from './utils';\n\nexport function useCountDown(props: TdUseCountDownProps): TdUseCountDown {\n  const { time = 0, autoStart, millisecond, format = 'HH:mm:ss', onFinish, onChange } = props || {};\n  // state\n  const fps = ref();\n  const count = ref(Number(time));\n  const showTimes = reactive(getShowTimes(getRemainTimes(time), format, !!millisecond));\n\n  // raf\n  const { pause, resume } = useRafFn(\n    async () => {\n      if (!fps.value) {\n        const res = await getScreenFps?.();\n        fps.value = res || 60;\n      }\n      count.value = parseInt(`${Number(count.value) - 1000 / fps.value}`, 10);\n      if (count.value <= 0) {\n        pause?.();\n        count.value = 0;\n      }\n      // console.log('count:', count.value);\n      const times = getRemainTimes(count.value);\n      onChange?.(times);\n      count.value === 0 && onFinish?.();\n      getShowTimes(times, format)?.forEach?.((i, idx) => (showTimes[idx].value = i?.value));\n    },\n    { immediate: autoStart },\n  );\n\n  /**\n   * return\n   */\n  return { time: count, showTimes, pause, resume };\n}\n"],"names":["useCountDown","props","time","autoStart","millisecond","format","onFinish","onChange","fps","ref","count","Number","showTimes","reactive","getShowTimes","getRemainTimes","useRafFn","_asyncToGenerator","_regeneratorRuntime","value","getScreenFps","res","parseInt","pause","times","forEach","i","idx","immediate","resume"],"mappings":"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"}