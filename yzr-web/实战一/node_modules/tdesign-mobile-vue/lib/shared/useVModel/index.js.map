{"version":3,"file":"index.js","sources":["../../../src/shared/useVModel/index.ts"],"sourcesContent":["import { ref, Ref, getCurrentInstance, ComponentInternalInstance } from 'vue';\n\nexport type ChangeHandler<T> = (value: T, ...args: any[]) => void;\n\nexport function useVModel<T>(\n  value: Ref<T>,\n  modelValue: Ref<T>,\n  defaultValue: T,\n  onChange?: (...args: any) => any,\n  propName = 'value',\n  // emit 和 eventName 用于支持 v-model 和 xxx.sync 语法糖\n): [Ref<T>, ChangeHandler<T>] {\n  const { emit } = getCurrentInstance() as ComponentInternalInstance;\n  const internalValue = ref<T>() as Ref<T>;\n  internalValue.value = defaultValue;\n\n  // 受控模式 v-model:propName\n  if (typeof value.value !== 'undefined') {\n    return [\n      value,\n      (newValue, ...args) => {\n        emit?.(`update:${propName}`, newValue, ...args);\n        onChange?.(newValue, ...args);\n      },\n    ];\n  }\n\n  // 受控模式:modelValue v-model\n  if (typeof modelValue.value !== 'undefined') {\n    return [\n      modelValue,\n      (newValue, ...args) => {\n        emit?.(`update:modelValue`, newValue, ...args);\n        onChange?.(newValue, ...args);\n      },\n    ];\n  }\n\n  // 非受控模式\n  return [\n    internalValue,\n    (newValue, ...args) => {\n      internalValue.value = newValue;\n      onChange?.(newValue, ...args);\n    },\n  ];\n}\n\n// emits name\nexport const UPDATE_MODEL = 'update:modelValue';\nexport const UPDATE_VALUE = 'update:value';\n"],"names":["useVModel","value","modelValue","defaultValue","onChange","propName","getCurrentInstance","emit","internalValue","ref","newValue","args","UPDATE_MODEL","UPDATE_VALUE"],"mappings":"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"}