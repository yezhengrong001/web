{"version":3,"file":"sticky.js","sources":["../../src/sticky/sticky.vue","../../src/sticky/sticky.vue?vue&type=template&id=05741920&lang.js"],"sourcesContent":["<template>\n  <div ref=\"boxRef\" :class=\"boxClasses\" :style=\"boxStyles\">\n    <div ref=\"contentRef\" :class=\"`${boxClasses}__content`\" :style=\"contentStyles\">\n      <t-node :content=\"stickyContent\"></t-node>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, getCurrentInstance, defineComponent, ref, watch } from 'vue';\nimport { useElementBounding, templateRef } from '@vueuse/core';\nimport props from './props';\nimport config from '../config';\nimport { renderContent, useEmitEvent, TNode } from '../shared';\n\nconst name = `${config.prefix}-sticky`;\n\nexport default defineComponent({\n  name,\n  components: { TNode },\n  props,\n  setup(props, context) {\n    const boxClasses = name;\n    const stickyContent = computed(() => renderContent(getCurrentInstance(), 'default', ''));\n    const emitEvent = useEmitEvent(props, context.emit);\n\n    // box 用于占位和记录边界\n    // content 用于实际定位\n    const boxRef = templateRef('boxRef');\n    const { top: boxTop } = useElementBounding(boxRef);\n    const contentRef = templateRef('contentRef');\n    const { top: contentTop, height } = useElementBounding(contentRef);\n\n    const boxStyles = computed(() => `height:${height.value}px;`);\n\n    // container 容器，sticky不会超出该边界\n    let container: HTMLElement;\n    const containerHeight = ref(0);\n    const containerTop = ref(0);\n\n    // 监听页面滚动事件\n    watch(boxTop, () => {\n      if (props.container) {\n        // @ts-ignore\n        container = document.querySelector(props.container);\n        const { top, height } = container.getBoundingClientRect();\n        containerHeight.value = height;\n        containerTop.value = top;\n      }\n    });\n\n    // 通过改变 content 的定位来实现 sticky 效果\n    const contentStyles = computed(() => {\n      let styleStr = `z-index:${props.zIndex};`;\n      let isFixed = false;\n      if (props.disabled) return styleStr;\n      const offsetTop = Number(props.offsetTop);\n      if (container) {\n        if (containerHeight.value + containerTop.value < offsetTop + height.value) {\n          styleStr += `transform:translate3d(0, ${containerHeight.value - height.value}px, 0);`;\n        } else if (boxTop.value <= offsetTop) {\n          styleStr += `position:fixed;top:${offsetTop}px;`;\n          isFixed = true;\n        }\n      } else if (boxTop.value <= offsetTop) {\n        styleStr += `position:fixed;top:${offsetTop}px;`;\n        isFixed = true;\n      }\n      emitEvent('scroll', { scrollTop: contentTop.value, isFixed });\n      return styleStr;\n    });\n\n    return {\n      boxClasses,\n      boxStyles,\n      contentStyles,\n      stickyContent,\n    };\n  },\n});\n</script>\n","<template>\n  <div ref=\"boxRef\" :class=\"boxClasses\" :style=\"boxStyles\">\n    <div ref=\"contentRef\" :class=\"`${boxClasses}__content`\" :style=\"contentStyles\">\n      <t-node :content=\"stickyContent\"></t-node>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, getCurrentInstance, defineComponent, ref, watch } from 'vue';\nimport { useElementBounding, templateRef } from '@vueuse/core';\nimport props from './props';\nimport config from '../config';\nimport { renderContent, useEmitEvent, TNode } from '../shared';\n\nconst name = `${config.prefix}-sticky`;\n\nexport default defineComponent({\n  name,\n  components: { TNode },\n  props,\n  setup(props, context) {\n    const boxClasses = name;\n    const stickyContent = computed(() => renderContent(getCurrentInstance(), 'default', ''));\n    const emitEvent = useEmitEvent(props, context.emit);\n\n    // box 用于占位和记录边界\n    // content 用于实际定位\n    const boxRef = templateRef('boxRef');\n    const { top: boxTop } = useElementBounding(boxRef);\n    const contentRef = templateRef('contentRef');\n    const { top: contentTop, height } = useElementBounding(contentRef);\n\n    const boxStyles = computed(() => `height:${height.value}px;`);\n\n    // container 容器，sticky不会超出该边界\n    let container: HTMLElement;\n    const containerHeight = ref(0);\n    const containerTop = ref(0);\n\n    // 监听页面滚动事件\n    watch(boxTop, () => {\n      if (props.container) {\n        // @ts-ignore\n        container = document.querySelector(props.container);\n        const { top, height } = container.getBoundingClientRect();\n        containerHeight.value = height;\n        containerTop.value = top;\n      }\n    });\n\n    // 通过改变 content 的定位来实现 sticky 效果\n    const contentStyles = computed(() => {\n      let styleStr = `z-index:${props.zIndex};`;\n      let isFixed = false;\n      if (props.disabled) return styleStr;\n      const offsetTop = Number(props.offsetTop);\n      if (container) {\n        if (containerHeight.value + containerTop.value < offsetTop + height.value) {\n          styleStr += `transform:translate3d(0, ${containerHeight.value - height.value}px, 0);`;\n        } else if (boxTop.value <= offsetTop) {\n          styleStr += `position:fixed;top:${offsetTop}px;`;\n          isFixed = true;\n        }\n      } else if (boxTop.value <= offsetTop) {\n        styleStr += `position:fixed;top:${offsetTop}px;`;\n        isFixed = true;\n      }\n      emitEvent('scroll', { scrollTop: contentTop.value, isFixed });\n      return styleStr;\n    });\n\n    return {\n      boxClasses,\n      boxStyles,\n      contentStyles,\n      stickyContent,\n    };\n  },\n});\n</script>\n"],"names":["name","config","prefix","defineComponent","components","TNode","props","setup","context","boxClasses","stickyContent","computed","renderContent","getCurrentInstance","emitEvent","useEmitEvent","emit","boxRef","templateRef","useElementBounding","boxTop","top","contentRef","contentTop","height","boxStyles","value","container","containerHeight","ref","containerTop","watch","document","querySelector","getBoundingClientRect","contentStyles","styleStr","zIndex","isFixed","disabled","offsetTop","Number","scrollTop","_createElementBlock","class","_ctx","style","_createElementVNode","_createVNode","_component_t_node","content"],"mappings":";;;;;;;;;;;;;;;;;;;;AAeA,IAAMA,IAAA,GAAA,EAAA,CAAA,MAAA,CAAUC,iBAAO,CAAAC,MAAA,EAAA,SAAA,CAAA,CAAA;AAEvB,aAAeC,mBAAgB,CAAA;AAC7BH,EAAAA,IAAA,EAAAA,IAAA;AACAI,EAAAA,UAAA,EAAY;AAAEC,IAAAA,KAAM,EAANA,6BAAAA;GAAM;AACpBC,EAAAA,KAAA,EAAAA,uBAAA;AACAC,EAAAA,KAAA,EAAMD,SAAAA,KAAAA,CAAAA,QAAOE,OAAS,EAAA;IACpB,IAAMC,UAAa,GAAAT,IAAA,CAAA;IACb,IAAAU,aAAA,GAAgBC,aAAS,YAAA;MAAA,OAAMC,2BAAA,CAAcC,wBAAsB,EAAA,SAAA,EAAW,EAAE,CAAC,CAAA;KAAA,CAAA,CAAA;IACvF,IAAMC,SAAY,GAAAC,sCAAA,CAAaT,MAAO,EAAAE,OAAA,CAAQQ,IAAI,CAAA,CAAA;AAI5C,IAAA,IAAAC,MAAA,GAASC,iBAAY,QAAQ,CAAA,CAAA;IACnC,IAAwBC,mBAAAA,GAAAA,wBAAmBF,MAAM,CAAA;AAApCG,MAAAA,MAAO,uBAAZC,GAAA,CAAA;AACF,IAAA,IAAAC,UAAA,GAAaJ,iBAAY,YAAY,CAAA,CAAA;IAC3C,IAAoCC,oBAAAA,GAAAA,wBAAmBG,UAAU,CAAA;AAApDC,MAAAA,UAAA,wBAALF,GAAK;AAAYG,MAAAA,MAAO,wBAAPA,MAAO,CAAA;IAEhC,IAAMC,SAAY,GAAAd,YAAA,CAAS,YAAA;MAAA,OAAgBa,SAAAA,CAAAA,MAAAA,CAAAA,OAAOE,KAAU,EAAA,KAAA,CAAA,CAAA;AAAA,KAAA,CAAA,CAAA;AAGxD,IAAA,IAAAC,SAAA,CAAA;AACE,IAAA,IAAAC,eAAA,GAAkBC,QAAI,CAAC,CAAA,CAAA;AACvB,IAAA,IAAAC,YAAA,GAAeD,QAAI,CAAC,CAAA,CAAA;IAG1BE,SAAA,CAAMX,QAAQ,YAAM;MAClB,IAAId,OAAMqB,SAAW,EAAA;QAEPA,SAAA,GAAAK,QAAA,CAASC,aAAc3B,CAAAA,MAAAA,CAAMqB,SAAS,CAAA,CAAA;QAClD,IAAwBA,qBAAAA,GAAAA,UAAUO,qBAAsB,EAAA;AAAhDb,UAAAA,GAAK,yBAALA,GAAK;AAAAG,UAAAA,OAAO,yBAAPA,MAAA,CAAA;QACbI,eAAA,CAAgBF,KAAQF,GAAAA,OAAAA,CAAAA;QACxBM,YAAA,CAAaJ,KAAQ,GAAAL,GAAA,CAAA;AACvB,OAAA;AACF,KAAC,CAAA,CAAA;AAGK,IAAA,IAAAc,aAAA,GAAgBxB,aAAS,YAAM;AAC/B,MAAA,IAAAyB,QAAA,GAAA,UAAA,CAAA,MAAA,CAAsB9B,MAAM,CAAA+B,MAAA,EAAA,GAAA,CAAA,CAAA;MAChC,IAAIC,OAAU,GAAA,KAAA,CAAA;AACd,MAAA,IAAIhC,MAAM,CAAAiC,QAAA,EAAiB,OAAAH,QAAA,CAAA;AACrB,MAAA,IAAAI,SAAA,GAAYC,MAAOnC,CAAAA,MAAAA,CAAMkC,SAAS,CAAA,CAAA;AACxC,MAAA,IAAIb,SAAW,EAAA;AACb,QAAA,IAAIC,gBAAgBF,KAAQ,GAAAI,YAAA,CAAaJ,KAAQ,GAAAc,SAAA,GAAYhB,OAAOE,KAAO,EAAA;UAC7DU,QAAA,IAAA,2BAAA,CAAA,MAAA,CAA4BR,eAAgB,CAAAF,KAAA,GAAQF,MAAO,CAAAE,KAAA,EAAA,SAAA,CAAA,CAAA;AACzE,SAAA,MAAA,IAAWN,MAAO,CAAAM,KAAA,IAASc,SAAW,EAAA;UACpCJ,QAAA,IAAA,qBAAA,CAAA,MAAA,CAAkCI,SAAA,EAAA,KAAA,CAAA,CAAA;AACxBF,UAAAA,OAAA,GAAA,IAAA,CAAA;AACZ,SAAA;AACF,OAAA,MAAA,IAAWlB,MAAO,CAAAM,KAAA,IAASc,SAAW,EAAA;QACpCJ,QAAA,IAAA,qBAAA,CAAA,MAAA,CAAkCI,SAAA,EAAA,KAAA,CAAA,CAAA;AACxBF,QAAAA,OAAA,GAAA,IAAA,CAAA;AACZ,OAAA;MACAxB,SAAA,CAAU,UAAU;QAAE4B,SAAA,EAAWnB,UAAW,CAAAG,KAAA;AAAOY,QAAAA,SAAAA,OAAAA;AAAQ,OAAC,CAAA,CAAA;AACrD,MAAA,OAAAF,QAAA,CAAA;AACT,KAAC,CAAA,CAAA;IAEM,OAAA;AACL3B,MAAAA,UAAA,EAAAA,UAAA;AACAgB,MAAAA,SAAA,EAAAA,SAAA;AACAU,MAAAA,aAAA,EAAAA,aAAA;AACAzB,MAAAA,aAAA,EAAAA,aAAAA;KACF,CAAA;AACF,GAAA;AACF,CAAC,CAAA;;;;wBC9EC,EAAAiC,sBAAA,CAIK,KAAA,EAAA;AAJAd,IAAAA,GAAI,EAAA,QAAA;AAAUe,IAAAA,KAAA,oBAAO,CAAAC,IAAA,CAAUpC,UAAA,CAAA;AAAGqC,IAAAA,KAAA,oBAAO,CAAAD,IAAA,CAASpB,SAAA,CAAA;MACrDsB,uBAEK,KAAA,EAAA;AAFAlB,IAAAA,GAAI,EAAA,YAAA;AAAce,IAAAA,oCAAUC,IAAA,CAAUpC,UAAA,EAAA,WAAA,CAAA,CAAA;AAAcqC,IAAAA,KAAA,oBAAO,CAAAD,IAAA,CAAaV,aAAA,CAAA;MAC3Ea,eAAA,CAAyCC,iBAAA,EAAA;IAAhCC,OAAS,EAAAL,IAAA,CAAanC,aAAAA;AAAA,GAAA,EAAA,IAAA,EAAA,CAAA,EAAA,CAAA,SAAA,CAAA,CAAA;;;;;;;"}